<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>War Campaign System â€“ Setup Integrated</title>
<style>
/* ===== Core layout ===== */
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#1a1a1a;color:#e6e0d6;}
#app{display:flex;height:100vh;}
#mapStage{flex:1;position:relative;}
#svgHost{position:absolute;inset:0;}
#svgHost svg{width:100%;height:100%;display:block;}
#sidePanel{width:360px;background:#222;border-left:2px solid #444;padding:12px;overflow:auto;}
h2{text-align:center;letter-spacing:2px;}
section{margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid #444;}
label{display:block;margin:6px 0;}
button{margin-top:8px;padding:6px 10px;background:#444;color:#eee;border:1px solid #666;cursor:pointer;}
button:disabled{opacity:.4;cursor:not-allowed;}
.factionRow{padding:6px;border:1px solid #444;margin-bottom:6px;cursor:pointer;}
.factionRow.active{outline:2px solid #aaa;}
/* ===== Setup overlay hint ===== */
#setupHint{
  position:absolute;top:10px;left:10px;
  background:rgba(0,0,0,.55);
  padding:6px 10px;
  border:1px solid #555;
  font-size:13px;
}
/* ===== Modal ===== */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:flex;align-items:center;justify-content:center;z-index:999;}
.modal.hidden{display:none;}
.modalBox{background:#222;padding:16px;border:2px solid #555;width:300px;}
.modalBox input{width:100%;margin:6px 0 12px 0;}
</style>
</head>
<body>

<div id="app">
  <div id="mapStage">
    <div id="setupHint">SETUP MODE: Select a faction, then click a territory to set its homeland</div>
    <div id="svgHost">
      <!-- your existing campaign SVG goes here -->
      <!-- keep the same <object> or inline SVG approach you already use -->
    </div>
  </div>

  <div id="sidePanel">
    <h2>CAMPAIGN SETUP</h2>

    <section>
      <h3>Active Theatres</h3>
      <label><input type="checkbox" checked data-theatre="WE"> Western Europe</label>
      <label><input type="checkbox" checked data-theatre="EE"> Eastern Europe</label>
      <label><input type="checkbox" data-theatre="NA"> North Africa</label>
      <label><input type="checkbox" data-theatre="PA"> Pacific</label>
    </section>

    <section>
      <h3>Factions</h3>
      <div id="factionList"></div>
      <button id="addFactionBtn">Add Faction</button>
    </section>

    <section>
      <h3>Assign Homeland</h3>
      <div id="assignInfo">Select a faction</div>
    </section>

    <button id="lockSetupBtn" disabled>LOCK CAMPAIGN SETUP</button>
  </div>
</div>

<div id="factionModal" class="modal hidden">
  <div class="modalBox">
    <h3>Create Faction</h3>
    <label>Faction Name</label>
    <input type="text" id="factionNameInput">
    <label>Faction Colour</label>
    <input type="color" id="factionColorInput" value="#888888">
    <button id="createFactionConfirm">Create</button>
    <button id="createFactionCancel">Cancel</button>
  </div>
</div>

<script>
/* ===== Global state ===== */
const state = {
  mode: "SETUP", // SETUP | PLAY
};

const setupState = {
  theatres:{WE:true,EE:true,NA:false,PA:false},
  factions:[],
  selectedFaction:null
};

/* ===== Setup UI ===== */
const factionList=document.getElementById("factionList");
const assignInfo=document.getElementById("assignInfo");
const modal=document.getElementById("factionModal");

document.getElementById("addFactionBtn").onclick=()=>modal.classList.remove("hidden");
document.getElementById("createFactionCancel").onclick=()=>modal.classList.add("hidden");

document.getElementById("createFactionConfirm").onclick=()=>{
  const name=factionNameInput.value.trim();
  if(!name) return;
  setupState.factions.push({
    id:crypto.randomUUID(),
    name,
    color:factionColorInput.value,
    homeland:null
  });
  modal.classList.add("hidden");
  factionNameInput.value="";
  renderFactions();
};

function renderFactions(){
  factionList.innerHTML="";
  setupState.factions.forEach(f=>{
    const div=document.createElement("div");
    div.className="factionRow"+(setupState.selectedFaction===f?" active":"");
    div.innerHTML=\`<strong style="color:\${f.color}">\${f.name}</strong><br>
      Homeland: \${f.homeland||"Not set"}\`;
    div.onclick=()=>{
      setupState.selectedFaction=f;
      assignInfo.textContent="Click a territory to assign homeland for "+f.name;
      renderFactions();
    };
    factionList.appendChild(div);
  });
}

/* ===== Territory hook (connects to your existing logic) ===== */
/*
  Call this function from your existing territory click handler:
  onTerritoryClick("WE-02")
*/
function onTerritoryClick(territoryId){
  if(state.mode!=="SETUP") return;
  if(!setupState.selectedFaction) return;

  setupState.selectedFaction.homeland = territoryId;

  // colour the territory using your existing fill logic
  try{
    const el=document.getElementById(territoryId);
    if(el) el.style.fill=setupState.selectedFaction.color;
  }catch(e){}

  renderFactions();
}
</script>

</body>
</html>
